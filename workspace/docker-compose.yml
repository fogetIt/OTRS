version: '2'

# volumes:
#   otrs_backups:

services:

  otrs:
    container_name: otrs
    build:
      context: build
      args:
        OTRS_USER: ${OTRS_USER}
        OTRS_VERSION: ${OTRS_VERSION}
    image: otrs:${OTRS_VERSION}
    env_file: .env
    environment:
      - OTRS_USER=${OTRS_USER}
      - OTRS_DB_HOST=mariadb
      - OTRS_DB_PORT=3306
      - OTRS_DB_CONTAINER=true
      - OTRS_DB_INIT=false
    volumes:
      # - otrs_backups:/var/otrs/backups
      - /etc/localtime:/etc/localtime:ro
      - ./volumes/supervisord.conf:/supervisord.conf
      - ./volumes/init-db.sql:/init-db.sql
      - ./volumes/run-otrs.sh:/run-otrs.sh
      - ./volumes/run-apache.sh:/run-apache.sh
      - ./volumes/apache2/ports.conf:/etc/apache2/ports.conf
      - ./volumes/apache2/sites-available/000-default.conf:/etc/apache2/sites-available/000-default.conf
    command: /usr/bin/supervisord -c /supervisord.conf
    ports:
      - 8080:8080
      - 9001:9001

  mariadb:
    image: mariadb:latest
    container_name: mariadb
    expose:
      - 3306
    ports:
      - 3306:3306
    env_file: .env
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./volumes/mariadb/my.conf:/etc/mysql/my.cnf